<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Game Score</title>

<style>
:root{
  color-scheme: dark;
  --bg:#000;
  --card:#111;
  --border:#333;
  --btn:#1e88e5;
  --red:#c62828;     /* TOP */
  --green:#2e7d32;   /* LOW */
  --muted:#aaa;
}
body{ margin:0; font-family:system-ui,-apple-system; background:var(--bg); color:#fff; }
h1{ margin:16px; }
.card{ border:1px solid var(--border); border-radius:16px; padding:16px; margin:16px; background:var(--card); }
.row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
button,input{
  padding:10px 14px; border-radius:12px; border:1px solid var(--border);
  background:#222; color:#fff; font-size:15px;
}
button.primary{ background:var(--btn); border:none; font-weight:700; }
button:active{ opacity:.85; }
input{ width:70px; text-align:center; }
.small{ font-size:13px; color:var(--muted); margin:6px 0 0; }
table{ width:100%; border-collapse:collapse; margin-top:12px; }
th,td{ padding:10px; border-bottom:1px solid var(--border); }
td.nameCell{ cursor:pointer; }
tr.top{ background:var(--red); }
tr.low{ background:var(--green); }
tr.out{ opacity:.35; }
.history{ font-size:13px; color:var(--muted); margin-top:10px; line-height:1.4; }
.pill{ display:inline-block; padding:2px 8px; border:1px solid #666; border-radius:999px; font-size:12px; margin-inline-start:8px; opacity:.9; }
</style>
</head>

<body>
<h1 id="title">üéÆ Game Score</h1>

<div class="card" id="setupCard">
  <div class="row">
    <span id="lblPlayers">Players</span>
    <input id="playersCount" type="number" min="2" max="10" value="2">
    <button class="primary" id="btnStart">Start / New Game</button>
  </div>

  <div class="row" style="margin-top:10px">
    <span id="lblLang">Language</span>
    <button id="btnAR">AR</button>
    <button id="btnEN">EN</button>
  </div>

  <p class="small" id="tip">Tip: This app auto-saves.</p>
</div>

<div class="card" id="gameCard" style="display:none">
  <div class="row">
    <button id="btnAddRound">‚ûï Add Round</button>
    <button id="btnAddPlayer">üë§ Add Player</button>
    <button id="btnNewGame" class="primary">üÜï New Game</button>
    <button id="btnGoSetup">‚öôÔ∏è Setup</button>
    <button id="btnReset">üîÑ Reset</button>
  </div>

  <div class="row" style="margin-top:10px">
    <span id="lblKick">Kick-out at</span>
    <input id="target" type="number" min="1" value="100">
    <span class="small" id="lblHint">Players become OUT when total ‚â• target.</span>
  </div>

  <table id="table">
    <thead>
      <tr>
        <th id="thPlayer">Player</th>
        <th id="thTotal">Total</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="history" id="history"></div>
</div>

<script>
const KEY = "gameScore_v2_local";
let state = {
  lang: "ar",
  names: [],
  totals: [],
  out: [],
  history: [],
  target: 100
};

const I18N = {
  ar: {
    title: "üéÆ ŸÜŸÇÿßÿ∑ ÿßŸÑŸÑÿπÿ®ÿ©",
    players: "ÿßŸÑŸÑÿßÿπÿ®ŸäŸÜ",
    start: "ÿßÿ®ÿØÿ£ / ŸÑÿπÿ®ÿ© ÿ¨ÿØŸäÿØÿ©",
    lang: "ÿßŸÑŸÑÿ∫ÿ©",
    tip: "ŸÖŸÑÿßÿ≠ÿ∏ÿ©: ÿßŸÑÿ≠ŸÅÿ∏ ÿ™ŸÑŸÇÿßÿ¶ŸäŸãÿß ÿπŸÑŸâ ÿßŸÑÿ¨Ÿáÿßÿ≤.",
    addRound: "‚ûï ÿ•ÿ∂ÿßŸÅÿ© ÿ¨ŸàŸÑÿ©",
    addPlayer: "üë§ ÿ•ÿ∂ÿßŸÅÿ© ŸÑÿßÿπÿ®",
    newGame: "üÜï ŸÑÿπÿ®ÿ© ÿ¨ÿØŸäÿØÿ©",
    setup: "‚öôÔ∏è ÿ•ÿπÿØÿßÿØÿßÿ™",
    reset: "üîÑ ÿ™ÿµŸÅŸäÿ±",
    kick: "ÿßŸÑÿ•ŸÇÿµÿßÿ° ÿπŸÜÿØ",
    hint: "Ÿäÿµÿ®ÿ≠ ÿßŸÑŸÑÿßÿπÿ® OUT ÿπŸÜÿØŸÖÿß ÿßŸÑŸÖÿ¨ŸÖŸàÿπ ‚â• ÿßŸÑŸáÿØŸÅ.",
    thPlayer: "ÿßŸÑŸÑÿßÿπÿ®",
    thTotal: "ÿßŸÑŸÖÿ¨ŸÖŸàÿπ",
    editName: "ÿ™ÿπÿØŸäŸÑ ÿßŸÑÿßÿ≥ŸÖ",
    pointsFor: "ŸÜŸÇÿßÿ∑ ÿßŸÑÿ¨ŸàŸÑÿ© ŸÑŸÄ",
    out: "OUT",
    round: "ÿ¨ŸàŸÑÿ©",
    confirmReset: "ÿ™ÿµŸÅŸäÿ± ŸÉŸÑ ÿßŸÑŸÜŸÇÿßÿ∑ Ÿàÿ•ÿ±ÿ¨ÿßÿπ ÿßŸÑÿ¨ŸÖŸäÿπ INÿü",
    confirmNew: "ÿ®ÿØÿ° ŸÑÿπÿ®ÿ© ÿ¨ÿØŸäÿØÿ©ÿü (ÿ≥Ÿäÿ™ŸÖ ŸÖÿ≥ÿ≠ ÿßŸÑÿ≠ÿßŸÑŸä)",
    maxPlayers: "ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ŸÇÿµŸâ 10 ŸÑÿßÿπÿ®ŸäŸÜ."
  },
  en: {
    title: "üéÆ Game Score",
    players: "Players",
    start: "Start / New Game",
    lang: "Language",
    tip: "Tip: This app auto-saves.",
    addRound: "‚ûï Add Round",
    addPlayer: "üë§ Add Player",
    newGame: "üÜï New Game",
    setup: "‚öôÔ∏è Setup",
    reset: "üîÑ Reset",
    kick: "Kick-out at",
    hint: "Players become OUT when total ‚â• target.",
    thPlayer: "Player",
    thTotal: "Total",
    editName: "Edit name",
    pointsFor: "Round points for",
    out: "OUT",
    round: "Round",
    confirmReset: "Reset all totals and set everyone IN?",
    confirmNew: "Start a new game? (clears current)",
    maxPlayers: "Max players is 10."
  }
};

function t(k){ return I18N[state.lang][k] || k; }

function save(){
  state.target = Math.max(1, Math.floor(+target.value || 100));
  localStorage.setItem(KEY, JSON.stringify(state));
}

function load(){
  try{
    const raw = localStorage.getItem(KEY);
    if(!raw) return;
    const s = JSON.parse(raw);
    if(!s) return;
    state = { ...state, ...s };
  }catch{}
}

function applyLang(){
  document.documentElement.lang = state.lang;
  document.documentElement.dir  = (state.lang === "ar") ? "rtl" : "ltr";

  title.textContent      = t("title");
  lblPlayers.textContent = t("players");
  btnStart.textContent   = t("start");
  lblLang.textContent    = t("lang");
  tip.textContent        = t("tip");

  btnAddRound.textContent  = t("addRound");
  btnAddPlayer.textContent = t("addPlayer");
  btnNewGame.textContent   = t("newGame");
  btnGoSetup.textContent   = t("setup");
  btnReset.textContent     = t("reset");

  lblKick.textContent   = t("kick");
  lblHint.textContent   = t("hint");
  thPlayer.textContent  = t("thPlayer");
  thTotal.textContent   = t("thTotal");
}

function showSetup(){
  setupCard.style.display = "";
  gameCard.style.display  = "none";
  applyLang();
}

function showGame(){
  setupCard.style.display = "none";
  gameCard.style.display  = "";
  target.value = state.target || 100;
  applyLang();
  render();
}

function newGame(n){
  state.names = Array.from({length:n}, (_,i)=>`Player ${i+1}`);
  state.totals = Array(n).fill(0);
  state.out = Array(n).fill(false);
  state.history = [];
  state.target = Math.max(1, Math.floor(+target.value || state.target || 100));
  save();
}

function computeTopLow(){
  const inIdx = state.totals.map((_,i)=>i).filter(i=>!state.out[i]);
  if(inIdx.length === 0) return { top:-1, low:-1, allEqual:true };

  let top = inIdx[0], low = inIdx[0];
  for(const i of inIdx){
    if(state.totals[i] > state.totals[top]) top = i;
    if(state.totals[i] < state.totals[low]) low = i;
  }
  const allEqual = inIdx.every(i => state.totals[i] === state.totals[inIdx[0]]);
  return { top, low, allEqual };
}

function render(){
  const tbody = document.querySelector("#table tbody");
  tbody.innerHTML = "";

  const {top, low, allEqual} = computeTopLow();

  state.names.forEach((name,i)=>{
    const tr = document.createElement("tr");

    if(state.out[i]) tr.classList.add("out");
    if(!state.out[i] && !allEqual && i===top) tr.classList.add("top");   // TOP = RED
    if(!state.out[i] && !allEqual && i===low) tr.classList.add("low");   // LOW = GREEN

    const tdName = document.createElement("td");
    tdName.className = "nameCell";
    tdName.innerHTML = `${escapeHtml(name)}${state.out[i] ? ` <span class="pill">${t("out")}</span>` : ""}`;
    tdName.onclick = ()=>editName(i);

    const tdTotal = document.createElement("td");
    tdTotal.textContent = String(state.totals[i]);

    tr.appendChild(tdName);
    tr.appendChild(tdTotal);
    tbody.appendChild(tr);
  });

  history.innerHTML = state.history.slice(0,12).map(h=>"‚Ä¢ "+escapeHtml(h)).join("<br>");
}

function escapeHtml(s){
  return String(s).replace(/[&<>"']/g, m => ({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[m]));
}

function editName(i){
  const val = prompt(t("editName"), state.names[i]);
  if(val === null) return;
  const name = val.trim();
  if(name) state.names[i] = name;
  save();
  render();
}

function addPlayer(){
  if(state.names.length >= 10) return alert(t("maxPlayers"));
  const val = prompt(t("addPlayer"), `Player ${state.names.length+1}`);
  if(val === null) return;
  const name = val.trim() || `Player ${state.names.length+1}`;
  state.names.push(name);
  state.totals.push(0);
  state.out.push(false);
  save();
  render();
}

function addRound(){
  const inIdx = state.names.map((_,i)=>i).filter(i=>!state.out[i]);
  if(inIdx.length === 0) return;

  const changes = [];
  for(const i of inIdx){
    const v = prompt(`${t("pointsFor")} ${state.names[i]}`, "0");
    if(v === null) return;
    const pts = Number(v) || 0;
    state.totals[i] += pts;
    changes.push(`${state.names[i]} +${pts}`);
    if(state.totals[i] >= state.target) state.out[i] = true;
  }

  state.history.unshift(`${t("round")}: ${changes.join(", ")}`);
  save();
  render();
}

function resetTotals(){
  if(!confirm(t("confirmReset"))) return;
  state.totals = state.totals.map(()=>0);
  state.out = state.out.map(()=>false);
  state.history = [];
  save();
  render();
}

function startFromSetup(){
  const n = Math.max(2, Math.min(10, Math.floor(+playersCount.value || 2)));
  newGame(n);

  // optional: rename players
  for(let i=0;i<state.names.length;i++){
    const v = prompt(`Name for ${state.names[i]}`, state.names[i]);
    if(v === null) break;
    const name = v.trim();
    if(name) state.names[i] = name;
  }

  save();
  showGame();
}

function newGameButton(){
  if(!confirm(t("confirmNew"))) return;
  showSetup();
}

btnStart.onclick = startFromSetup;
btnAddRound.onclick = addRound;
btnAddPlayer.onclick = addPlayer;
btnReset.onclick = resetTotals;
btnNewGame.onclick = newGameButton;
btnGoSetup.onclick = showSetup;

btnAR.onclick = ()=>{ state.lang="ar"; save(); applyLang(); render(); };
btnEN.onclick = ()=>{ state.lang="en"; save(); applyLang(); render(); };

target.onchange = ()=>{
  state.target = Math.max(1, Math.floor(+target.value || 100));
  // re-evaluate OUT based on new target
  state.out = state.totals.map(x => x >= state.target);
  save();
  render();
};

// boot
load();
applyLang();
if(state.names && state.names.length >= 2) showGame();
else showSetup();
</script>
</body>
</html>
